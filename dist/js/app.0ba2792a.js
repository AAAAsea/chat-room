(function(){"use strict";var e={6805:function(e,n,a){var t=a(9242),s=a(3396),r=a(4870),o=a(2066),i=a(7139);function l(e){var n=e,a=n.getMonth()+1,t=n.getDate(),s=n.getHours(),r=n.getMinutes(),o=Array.apply(null,Array(10)).map((function(e,n){return"0"+n}));let i="";return new Date-n>864e5&&(i=(o[a]||a)+"-"+(o[t]||t)+" "),i+=(o[s]||s)+":"+(o[r]||r),i}function u(e){return e<1024?~~(e/1024)+"B":e<1048576?~~(e/1024)+"KB":e<1073741824?~~(e/1024/1024)+"M":void 0}var c=a(1610),m=a.n(c);const f=e=>((0,s.dD)("data-v-e1b236c4"),e=e(),(0,s.Cn)(),e),p={id:"chat"},d={class:"left"},v={class:"user"},_=["src"],g={class:"name"},h={class:"label"},w={class:"users"},b=f((()=>(0,s._)("img",{src:"http://img95.699pic.com/photo/40168/4515.jpg_wh300.jpg",class:"avatar"},null,-1))),y=f((()=>(0,s._)("span",{class:"name"},"广场",-1))),E={key:0,class:"redPoint"},R=["onClick"],N=["src"],k={class:"name"},D={key:0},U={key:1,class:"redPoint"},S={class:"right"},V={class:"title"},C={key:0,class:"control"},O={class:"chat-box",ref:"chatBoxRef",id:"chat-box"},L=["src","onClick"],z={class:"content-box"},P={class:"nickname"},x={key:0,class:"content"},A={class:"bubble"},j={class:"bubble-cont"},T={key:1,class:"content file"},B={class:"bubble"},I=["href"],M=["src"],q=["href"],K={class:"file-info"},Z=f((()=>(0,s._)("svg",{class:"icon","aria-hidden":"true"},[(0,s._)("use",{"xlink:href":"#icon-file1"})],-1))),F={class:"bottom"},H={class:"toolbar"},W={class:"iconfont icon-wenjianjia"},Y=["onKeydown"];var G={props:["socket","username","users","userImg","SERVER_URL"],emits:["updateUsers"],setup(e,{emit:n}){const a=e,o=(0,r.ref)({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON);console.log({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"});const c=a.socket,f=(0,r.reactive)({public:0}),G=(0,r.reactive)({public:[]});let J=(0,r.reactive)({public:0});const Q=(0,r.ref)("public"),X=(0,r.ref)(""),$=e=>{e.preventDefault(),""!==X.value&&("public"===Q.value||a.users.find((e=>e.username===Q.value))?("public"===Q.value?c.emit("sendMessage",X.value):c.emit("sendMessageToOne",{msg:X.value,toName:Q.value,fromName:a.username}),X.value=""):alert("该用户已下线"))};function ee(){(0,s.Y3)((()=>{let e=document.getElementById("chat-box");e.scrollTop=e.scrollHeight+200}))}c.on("receiveMessage",(e=>{console.log(e),G[e.fromName]||(G[e.fromName]=[]),G[e.toName]||(G[e.toName]=[]),f[e.fromName]||(f[e.fromName]=0),J[e.fromName]||(J[e.fromName]=0),J[e.toName]||(J[e.toName]=0),e.fromName?e.fromName===a.username?(n("updateUsers",e.toName),new Date-J[e.toName]>12e4&&G[e.toName].push({type:"system",class:"time",msg:l(new Date)}),J[e.toName]=new Date,G[e.toName].push(e)):(n("updateUsers",e.fromName),new Date-J[e.fromName]>12e4&&G[e.fromName].push({type:"system",class:"time",msg:l(new Date)}),J[e.fromName]=new Date,G[e.fromName].push(e),Q.value!==e.fromName&&f[e.fromName]++):(new Date-J.public>12e4&&G.public.push({type:"system",class:"time",msg:l(new Date)}),G.public.push(e),"public"!==Q.value&&f.public++,J.public=new Date),ee()})),c.on("addUser",(e=>{new Date-J.public>12e4&&G.public.push({class:"time",type:"system",msg:l(new Date)}),J.public=new Date,G.public.push({class:"in",type:"system",msg:e.username+"进来了"}),ee()})),c.on("delUser",(e=>{new Date-J.public>12e4&&G.public.push({type:"system",class:"time",msg:l(new Date)}),J.public=new Date,G.public.push({class:"leave",type:"system",msg:e.username+"离开了"}),ee()}));const ne=(0,r.ref)("");function ae(){let e=ne.value.files[0];if(!e)return;if(e.size>5242880)return void alert("文件不能大于10M");let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{console.log("发送文件"),c.emit("sendFile",{fileName:e.name,fileSize:e.size,fileType:e.type,raw:n.result,toName:Q.value,fromName:a.username})}}function te(){window.electron.ipcRenderer.send("shutDown")}function se(){window.electron.ipcRenderer.send("minimize")}return(n,a)=>((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("div",d,[(0,s._)("div",v,[(0,s._)("img",{src:e.userImg,class:"avatar"},null,8,_),(0,s._)("span",g,(0,i.zw)(e.username),1)]),(0,s._)("h3",h,"在线列表（"+(0,i.zw)(e.users.length)+"）",1),(0,s._)("div",w,[(0,s._)("div",{class:(0,i.C_)(["user",{active:"public"===Q.value}]),onClick:a[0]||(a[0]=e=>{Q.value="public",(0,r.unref)(f).public=0,ee()})},[b,y,(0,r.unref)(f).public?((0,s.wg)(),(0,s.iD)("span",E,(0,i.zw)((0,r.unref)(f).public>99?"99+":(0,r.unref)(f).public),1)):(0,s.kq)("",!0)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.users,(n=>((0,s.wg)(),(0,s.iD)("div",{class:(0,i.C_)(["user",{active:Q.value===n.username}]),key:n.username,onClick:e=>{Q.value=n.username,(0,r.unref)(f)[n.username]=0,ee()}},[(0,s._)("img",{src:n.avatar,class:"avatar"},null,8,N),(0,s._)("span",k,(0,i.zw)(n.username),1),n.username===e.username?((0,s.wg)(),(0,s.iD)("span",D,"(我)")):(0,s.kq)("",!0),(0,r.unref)(f)[n.username]?((0,s.wg)(),(0,s.iD)("span",U,(0,i.zw)((0,r.unref)(f)[n.username]>99?"99+":(0,r.unref)(f)[n.username]),1)):(0,s.kq)("",!0)],10,R)))),128))])]),(0,s._)("div",S,[(0,s._)("div",V,[(0,s._)("span",null,(0,i.zw)("public"===Q.value?"广场":Q.value),1)]),o.value?((0,s.wg)(),(0,s.iD)("div",C,[(0,s._)("span",{class:"iconfont icon-2zuixiaohua-2",onClick:se}),(0,s._)("span",{class:"iconfont icon-4guanbi-2",onClick:te})])):(0,s.kq)("",!0),(0,s._)("div",O,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)((0,r.unref)(G)[Q.value],((n,a)=>((0,s.wg)(),(0,s.iD)("div",{class:(0,i.C_)(["message-box",n.username!==e.username?"other":"my"]),key:a},["system"!==n.type?((0,s.wg)(),(0,s.iD)("img",{key:0,src:n.avatar,class:"avatar",onClick:e=>{Q.value=n.username,(0,r.unref)(f)[n.username]=0}},null,8,L)):(0,s.kq)("",!0),(0,s._)("div",z,[(0,s._)("div",P,(0,i.zw)(n.username),1),"common"===n.type?((0,s.wg)(),(0,s.iD)("div",x,[(0,s._)("div",A,[(0,s._)("div",j,(0,i.zw)(n.msg),1)])])):(0,s.kq)("",!0),"file"===n.type?((0,s.wg)(),(0,s.iD)("div",T,[(0,s._)("div",B,[n.fileType.startsWith("image")?((0,s.wg)(),(0,s.iD)("a",{key:0,href:e.SERVER_URL+"/upload?fileName="+n.fileName},[(0,s._)("img",{style:{margin:"10px 0",borderRadius:"4px",maxWidth:"100%",objectFit:"cover",overflow:"hidden"},src:e.SERVER_URL+"/upload?fileName="+n.fileName},null,8,M)],8,I)):((0,s.wg)(),(0,s.iD)("a",{key:1,class:"bubble-cont",href:e.SERVER_URL+"/upload?fileName="+n.fileName,download:""},[(0,s._)("div",K,[(0,s._)("p",null,(0,i.zw)(n.fileName),1),(0,s._)("span",null,(0,i.zw)((0,r.unref)(u)(n.fileSize)),1)]),Z],8,q))])])):(0,s.kq)("",!0)]),"system"===n.type?((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,i.C_)(["system",n.class])},(0,i.zw)(n.msg),3)):(0,s.kq)("",!0)],2)))),128))],512),(0,s._)("div",F,[(0,s._)("div",H,[(0,s._)("label",W,[(0,s._)("input",{type:"file",ref_key:"fileRef",ref:ne,style:{display:"none"},onChange:ae},null,544)]),(0,s.Wm)((0,r.unref)(m()),{class:"emoji","gif-format":"md",onEmoji:a[1]||(a[1]=e=>X.value+=e)})]),(0,s.wy)((0,s._)("textarea",{onKeydown:(0,t.D2)($,["enter"]),class:"edit","onUpdate:modelValue":a[2]||(a[2]=e=>X.value=e),maxlength:"500"},null,40,Y),[[t.nr,X.value]]),(0,s._)("button",{onClick:$},"发送")])])]))}},J=a(89);const Q=(0,J.Z)(G,[["__scopeId","data-v-e1b236c4"]]);var X=Q;const $=e=>((0,s.dD)("data-v-08689564"),e=e(),(0,s.Cn)(),e),ee={id:"login"},ne={key:0,class:"control"},ae=$((()=>(0,s._)("h2",null,"登录",-1))),te=$((()=>(0,s._)("div",{class:"label"},"用户昵称",-1))),se=["onKeyup"];var re={emits:["change-login"],setup(e,{emit:n}){const a=(0,r.ref)(""),o=(0,r.ref)({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON);console.log({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"});const i=()=>{""!==a.value.trim()?n("change-login",a.value):alert("用户昵称不能为空")};function l(){window.electron.ipcRenderer.send("shutDown")}function u(){window.electron.ipcRenderer.send("minimize")}return(e,n)=>((0,s.wg)(),(0,s.iD)("div",ee,[o.value?((0,s.wg)(),(0,s.iD)("div",ne,[(0,s._)("span",{class:"iconfont icon-2zuixiaohua-2",onClick:u}),(0,s._)("span",{class:"iconfont icon-4guanbi-2",onClick:l})])):(0,s.kq)("",!0),ae,te,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=e=>a.value=e),onKeyup:(0,t.D2)(i,["enter"]),maxlength:"10",autofocus:"autofocus"},null,40,se),[[t.nr,a.value]]),(0,s._)("button",{onClick:i},"登录")]))}};const oe=(0,J.Z)(re,[["__scopeId","data-v-08689564"]]);var ie=oe,le=a(2111);const ue={class:"main"};var ce={setup(e){const{ref:n,reactive:t}=a(4870);let i="/";({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}).IS_ELECTRON&&(i="https://chat.asea.fun",document.getElementsByTagName("html")[0].style.background="transparent",document.getElementById("app").style.overflow="hidden");let l=(0,o.ZP)(i);setTimeout((()=>{console.log(l)}),1e3);const u=n(!1),c=n(""),m=n(""),f=e=>{l.connected||(l=(0,o.ZP)(i)),c.value=e,m.value="https://cravatar.cn/avatar/"+e+"?d=wavatar",l.emit("login",{username:e,avatar:"https://cravatar.cn/avatar/"+e+"?d=wavatar"})},p=t([]),d=e=>{for(let n in p)if(p[n].username===e){let e=p[n];p.splice(n,1),p.unshift(e);break}};return l.on("loginSuccess",(e=>{(0,le.z8)({message:"登陆成功",type:"success"}),u.value=!0,p.splice(0),p.push(...e),{NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON&&window.electron.ipcRenderer.send("resize",!0)})),l.on("loginError",(e=>{alert(e.msg)})),l.on("addUser",(e=>{e.username!==c.value&&(p.find((n=>n.username===e.username))||p.push(e))})),l.on("delUser",(e=>{for(let n in p)p[n].username===e.username&&p.splice(n,1)})),l.on("disconnect",(()=>{le.z8.error("长时间未操作，已断开连接..."),u.value=!1,{NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON&&window.electron.ipcRenderer.send("resize",!1)})),l.on("reconnect",(()=>{})),(e,n)=>((0,s.wg)(),(0,s.iD)("div",ue,[u.value?((0,s.wg)(),(0,s.j4)(X,{key:1,socket:(0,r.unref)(l),username:c.value,userImg:m.value,users:(0,r.unref)(p),SERVER_URL:"https://chat.asea.fun",onUpdateUsers:d},null,8,["socket","username","userImg","users"])):((0,s.wg)(),(0,s.j4)(ie,{key:0,onChangeLogin:f}))]))}};const me=(0,J.Z)(ce,[["__scopeId","data-v-6c54e6aa"]]);var fe=me;a(4415);(0,t.ri)(fe).mount("#app")}},n={};function a(t){var s=n[t];if(void 0!==s)return s.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(n,t,s,r){if(!t){var o=1/0;for(c=0;c<e.length;c++){t=e[c][0],s=e[c][1],r=e[c][2];for(var i=!0,l=0;l<t.length;l++)(!1&r||o>=r)&&Object.keys(a.O).every((function(e){return a.O[e](t[l])}))?t.splice(l--,1):(i=!1,r<o&&(o=r));if(i){e.splice(c--,1);var u=s();void 0!==u&&(n=u)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[t,s,r]}}(),function(){a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,{a:n}),n}}(),function(){a.d=function(e,n){for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(n){return 0===e[n]};var n=function(n,t){var s,r,o=t[0],i=t[1],l=t[2],u=0;if(o.some((function(n){return 0!==e[n]}))){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(l)var c=l(a)}for(n&&n(t);u<o.length;u++)r=o[u],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},t=self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var t=a.O(void 0,[998],(function(){return a(6805)}));t=a.O(t)})();