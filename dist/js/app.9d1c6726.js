(function(){"use strict";var e={5250:function(e,n,a){var t=a(9242),s=a(3396),r=a(4870),o=a(2066),l=a(7139);function i(e){var n=e,a=n.getMonth()+1,t=n.getDate(),s=n.getHours(),r=n.getMinutes(),o=Array.apply(null,Array(10)).map((function(e,n){return"0"+n}));let l="";return new Date-n>864e5&&(l=(o[a]||a)+"-"+(o[t]||t)+" "),l+=(o[s]||s)+":"+(o[r]||r),l}function u(e){return e<1024?~~(e/1024)+"B":e<1048576?~~(e/1024)+"KB":e<1073741824?~~(e/1024)+"M":void 0}var c=a(1610),m=a.n(c);const f=e=>((0,s.dD)("data-v-e46038c8"),e=e(),(0,s.Cn)(),e),p={id:"chat"},d={class:"left"},v={class:"user"},_=["src"],g={class:"name"},h={class:"label"},w={class:"users"},y=f((()=>(0,s._)("img",{src:"http://img95.699pic.com/photo/40168/4515.jpg_wh300.jpg",class:"avatar"},null,-1))),b=f((()=>(0,s._)("span",{class:"name"},"广场",-1))),E={key:0,class:"redPoint"},R=["onClick"],N=["src"],D={class:"name"},k={key:0},U={key:1,class:"redPoint"},S={class:"right"},V={class:"title"},C={key:0,class:"control"},O={class:"chat-box",ref:"chatBoxRef",id:"chat-box"},L=["src","onClick"],P={key:1,class:"content"},z={class:"bubble"},x={class:"bubble-cont"},A={key:2,class:"content file"},j={class:"bubble"},T=["href"],B=["src"],I=["href"],M={class:"file-info"},q=f((()=>(0,s._)("svg",{class:"icon","aria-hidden":"true"},[(0,s._)("use",{"xlink:href":"#icon-file1"})],-1))),K={class:"bottom"},Z={class:"toolbar"},F={class:"iconfont icon-wenjianjia"},H=["onKeydown"];var W={props:["socket","username","users","userImg","SERVER_URL"],emits:["updateUsers"],setup(e,{emit:n}){const a=e,o=(0,r.ref)({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON);console.log({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"});const c=a.socket,f=(0,r.reactive)({public:0}),W=(0,r.reactive)({public:[]});let Y=(0,r.reactive)({public:0});const G=(0,r.ref)("public"),J=(0,r.ref)(""),Q=e=>{e.preventDefault(),""!==J.value&&("public"===G.value||a.users.find((e=>e.username===G.value))?("public"===G.value?c.emit("sendMessage",J.value):c.emit("sendMessageToOne",{msg:J.value,toName:G.value,fromName:a.username}),J.value=""):alert("该用户已下线"))};function X(){(0,s.Y3)((()=>{let e=document.getElementById("chat-box");e.scrollTop=e.scrollHeight+200}))}c.on("receiveMessage",(e=>{console.log(e),W[e.fromName]||(W[e.fromName]=[]),W[e.toName]||(W[e.toName]=[]),f[e.fromName]||(f[e.fromName]=0),Y[e.fromName]||(Y[e.fromName]=0),Y[e.toName]||(Y[e.toName]=0),e.fromName?e.fromName===a.username?(n("updateUsers",e.toName),new Date-Y[e.toName]>12e4&&W[e.toName].push({type:"system",class:"time",msg:i(new Date)}),Y[e.toName]=new Date,W[e.toName].push(e)):(n("updateUsers",e.fromName),new Date-Y[e.fromName]>12e4&&W[e.fromName].push({type:"system",class:"time",msg:i(new Date)}),Y[e.fromName]=new Date,W[e.fromName].push(e),G.value!==e.fromName&&f[e.fromName]++):(new Date-Y.public>12e4&&W.public.push({type:"system",class:"time",msg:i(new Date)}),W.public.push(e),"public"!==G.value&&f.public++,Y.public=new Date),X()})),c.on("addUser",(e=>{new Date-Y.public>12e4&&W.public.push({class:"time",type:"system",msg:i(new Date)}),Y.public=new Date,W.public.push({class:"in",type:"system",msg:e.username+"进来了"}),X()})),c.on("delUser",(e=>{new Date-Y.public>12e4&&W.public.push({type:"system",class:"time",msg:i(new Date)}),Y.public=new Date,W.public.push({class:"leave",type:"system",msg:e.username+"离开了"}),X()}));const $=(0,r.ref)("");function ee(){let e=$.value.files[0];if(!e)return;if(e.size>10485760)return void alert("文件不能大于10M");let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{console.log("发送文件"),c.emit("sendFile",{fileName:e.name,fileSize:e.size,fileType:e.type,raw:n.result,toName:G.value,fromName:a.username})}}function ne(){window.electron.ipcRenderer.send("shutDown")}function ae(){window.electron.ipcRenderer.send("minimize")}return(n,a)=>((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("div",d,[(0,s._)("div",v,[(0,s._)("img",{src:e.userImg,class:"avatar"},null,8,_),(0,s._)("span",g,(0,l.zw)(e.username),1)]),(0,s._)("h3",h,"在线列表（"+(0,l.zw)(e.users.length)+"）",1),(0,s._)("div",w,[(0,s._)("div",{class:(0,l.C_)(["user",{active:"public"===G.value}]),onClick:a[0]||(a[0]=e=>{G.value="public",(0,r.unref)(f).public=0,X()})},[y,b,(0,r.unref)(f).public?((0,s.wg)(),(0,s.iD)("span",E,(0,l.zw)((0,r.unref)(f).public>99?"99+":(0,r.unref)(f).public),1)):(0,s.kq)("",!0)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.users,(n=>((0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)(["user",{active:G.value===n.username}]),key:n.username,onClick:e=>{G.value=n.username,(0,r.unref)(f)[n.username]=0,X()}},[(0,s._)("img",{src:n.avatar,class:"avatar"},null,8,N),(0,s._)("span",D,(0,l.zw)(n.username),1),n.username===e.username?((0,s.wg)(),(0,s.iD)("span",k,"(我)")):(0,s.kq)("",!0),(0,r.unref)(f)[n.username]?((0,s.wg)(),(0,s.iD)("span",U,(0,l.zw)((0,r.unref)(f)[n.username]>99?"99+":(0,r.unref)(f)[n.username]),1)):(0,s.kq)("",!0)],10,R)))),128))])]),(0,s._)("div",S,[(0,s._)("div",V,[(0,s._)("span",null,(0,l.zw)("public"===G.value?"广场":G.value),1)]),o.value?((0,s.wg)(),(0,s.iD)("div",C,[(0,s._)("span",{class:"iconfont icon-2zuixiaohua-2",onClick:ae}),(0,s._)("span",{class:"iconfont icon-4guanbi-2",onClick:ne})])):(0,s.kq)("",!0),(0,s._)("div",O,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)((0,r.unref)(W)[G.value],((n,a)=>((0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)(["message-box",n.username!==e.username?"other":"my"]),key:a},["system"!==n.type?((0,s.wg)(),(0,s.iD)("img",{key:0,src:n.avatar,class:"avatar",onClick:e=>{G.value=n.username,(0,r.unref)(f)[n.username]=0}},null,8,L)):(0,s.kq)("",!0),"common"===n.type?((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",z,[(0,s._)("div",x,(0,l.zw)(n.msg),1)])])):(0,s.kq)("",!0),"file"===n.type?((0,s.wg)(),(0,s.iD)("div",A,[(0,s._)("div",j,[n.fileType.startsWith("image")?((0,s.wg)(),(0,s.iD)("a",{key:0,href:e.SERVER_URL+"/upload?fileName="+n.fileName},[(0,s._)("img",{style:{margin:"10px 0",borderRadius:"4px",maxWidth:"100%",objectFit:"cover",overflow:"hidden"},src:e.SERVER_URL+"/upload?fileName="+n.fileName},null,8,B)],8,T)):((0,s.wg)(),(0,s.iD)("a",{key:1,class:"bubble-cont",href:e.SERVER_URL+"/upload?fileName="+n.fileName,download:""},[(0,s._)("div",M,[(0,s._)("p",null,(0,l.zw)(n.fileName),1),(0,s._)("span",null,(0,l.zw)((0,r.unref)(u)(n.fileSize)),1)]),q],8,I))])])):(0,s.kq)("",!0),"system"===n.type?((0,s.wg)(),(0,s.iD)("div",{key:3,class:(0,l.C_)(["system",n.class])},(0,l.zw)(n.msg),3)):(0,s.kq)("",!0)],2)))),128))],512),(0,s._)("div",K,[(0,s._)("div",Z,[(0,s._)("label",F,[(0,s._)("input",{type:"file",ref_key:"fileRef",ref:$,style:{display:"none"},onChange:ee},null,544)]),(0,s.Wm)((0,r.unref)(m()),{class:"emoji","gif-format":"md",onEmoji:a[1]||(a[1]=e=>J.value+=e)})]),(0,s.wy)((0,s._)("textarea",{onKeydown:(0,t.D2)(Q,["enter"]),class:"edit","onUpdate:modelValue":a[2]||(a[2]=e=>J.value=e),maxlength:"500"},null,40,H),[[t.nr,J.value]]),(0,s._)("button",{onClick:Q},"发送")])])]))}},Y=a(89);const G=(0,Y.Z)(W,[["__scopeId","data-v-e46038c8"]]);var J=G;const Q=e=>((0,s.dD)("data-v-08689564"),e=e(),(0,s.Cn)(),e),X={id:"login"},$={key:0,class:"control"},ee=Q((()=>(0,s._)("h2",null,"登录",-1))),ne=Q((()=>(0,s._)("div",{class:"label"},"用户昵称",-1))),ae=["onKeyup"];var te={emits:["change-login"],setup(e,{emit:n}){const a=(0,r.ref)(""),o=(0,r.ref)({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON);console.log({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"});const l=()=>{""!==a.value.trim()?n("change-login",a.value):alert("用户昵称不能为空")};function i(){window.electron.ipcRenderer.send("shutDown")}function u(){window.electron.ipcRenderer.send("minimize")}return(e,n)=>((0,s.wg)(),(0,s.iD)("div",X,[o.value?((0,s.wg)(),(0,s.iD)("div",$,[(0,s._)("span",{class:"iconfont icon-2zuixiaohua-2",onClick:u}),(0,s._)("span",{class:"iconfont icon-4guanbi-2",onClick:i})])):(0,s.kq)("",!0),ee,ne,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=e=>a.value=e),onKeyup:(0,t.D2)(l,["enter"]),maxlength:"10",autofocus:"autofocus"},null,40,ae),[[t.nr,a.value]]),(0,s._)("button",{onClick:l},"登录")]))}};const se=(0,Y.Z)(te,[["__scopeId","data-v-08689564"]]);var re=se;const oe={class:"main"};var le={setup(e){const{ref:n,reactive:t}=a(4870);let l="/";({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}).IS_ELECTRON&&(l="https://chat.asea.fun",document.getElementsByTagName("html")[0].style.background="transparent",document.getElementById("app").style.overflow="hidden");let i=(0,o.ZP)(l);setTimeout((()=>{console.log(i)}),1e3);const u=n(!1),c=n(""),m=n(""),f=e=>{i.connected||(i=(0,o.ZP)(l)),c.value=e,m.value="https://cravatar.cn/avatar/"+e+"?d=wavatar",i.emit("login",{username:e,avatar:"https://cravatar.cn/avatar/"+e+"?d=wavatar"})},p=t([]),d=e=>{for(let n in p)if(p[n].username===e){let e=p[n];p.splice(n,1),p.unshift(e);break}};return i.on("loginSuccess",(e=>{console.log("登陆成功"),u.value=!0,p.splice(0),p.push(...e),{NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON&&window.electron.ipcRenderer.send("resize",!0)})),i.on("loginError",(e=>{alert(e.msg)})),i.on("addUser",(e=>{e.username!==c.value&&(p.find((n=>n.username===e.username))||p.push(e))})),i.on("delUser",(e=>{for(let n in p)p[n].username===e.username&&p.splice(n,1)})),i.on("disconnect",(()=>{alert("长时间未操作，已断开连接..."),u.value=!1,{NODE_ENV:"production",VUE_APP_SERVER_URL:"https://chat.asea.fun/",BASE_URL:"/"}.IS_ELECTRON&&window.electron.ipcRenderer.send("resize",!1)})),i.on("reconnect",(()=>{console.log("重新连接"),i.emit("login",{username:name,avatar:m.value})})),(e,n)=>((0,s.wg)(),(0,s.iD)("div",oe,[u.value?((0,s.wg)(),(0,s.j4)(J,{key:1,socket:(0,r.unref)(i),username:c.value,userImg:m.value,users:(0,r.unref)(p),SERVER_URL:"https://chat.asea.fun",onUpdateUsers:d},null,8,["socket","username","userImg","users"])):((0,s.wg)(),(0,s.j4)(re,{key:0,onChangeLogin:f}))]))}};const ie=(0,Y.Z)(le,[["__scopeId","data-v-536d3487"]]);var ue=ie;(0,t.ri)(ue).mount("#app")}},n={};function a(t){var s=n[t];if(void 0!==s)return s.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(n,t,s,r){if(!t){var o=1/0;for(c=0;c<e.length;c++){t=e[c][0],s=e[c][1],r=e[c][2];for(var l=!0,i=0;i<t.length;i++)(!1&r||o>=r)&&Object.keys(a.O).every((function(e){return a.O[e](t[i])}))?t.splice(i--,1):(l=!1,r<o&&(o=r));if(l){e.splice(c--,1);var u=s();void 0!==u&&(n=u)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[t,s,r]}}(),function(){a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,{a:n}),n}}(),function(){a.d=function(e,n){for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(n){return 0===e[n]};var n=function(n,t){var s,r,o=t[0],l=t[1],i=t[2],u=0;if(o.some((function(n){return 0!==e[n]}))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(i)var c=i(a)}for(n&&n(t);u<o.length;u++)r=o[u],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},t=self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var t=a.O(void 0,[998],(function(){return a(5250)}));t=a.O(t)})();